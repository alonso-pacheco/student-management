<!DOCTYPE html>
<html>
<head>
    <title>Lista de Estudiantes</title>
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">
    <h1 class="mb-4">Registro de Estudiantes</h1>

    <!-- Mensajes -->
    {% if messages %}
        {% for message in messages %}
        <div class="alert alert-info">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <a href="{% url 'students:student' %}" class="btn btn-success mb-3">Agregar Estudiante</a>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Edad</th>
                <th>Email</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for student in students %}
            <tr>
                <td>{{ student.id }}</td>
                <td>{{ student.name }}</td>
                <td>{{ student.age }}</td>
                <td>{{ student.email }}</td>
                <td>
                    <a href="{% url 'students:student_form' student.id %}" class="btn btn-primary btn-sm">Editar</a>
                    <button class="btn btn-danger btn-sm"
                            onclick="deleteStudent({{ student.id }})">
                        Eliminar
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center">No hay estudiantes disponibles</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <script>
        function deleteStudent(studentId) {
            if(!confirm('¿Estás seguro de eliminar este estudiante?')) return;

            fetch(`http://127.0.0.1:5000/students/${studentId}`, {
                method: 'DELETE'
            })
            .then(response => {
                if(response.ok) {
                    location.reload(); // recarga la página después de eliminar
                } else {
                    alert('Error al eliminar estudiante');
                }
            })
            .catch(err => alert('Error al conectar con la API'));
        }
    </script>
</body>
</html>
